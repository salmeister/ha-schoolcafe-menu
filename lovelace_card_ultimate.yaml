# Ultimate SchoolCafe Menu Card - Predictable Week View
# This card uses the new sensor naming scheme and automatically shows
# only school days in chronological order, regardless of what day today is.

type: vertical-stack
title: üçΩÔ∏è PLHS Lunch Menu
cards:
  # Today's Menu (only show if it's a school day)
  - type: conditional
    conditions:
      - condition: template
        value_template: >
          {{ state_attr('sensor.schoolcafe_blue_line_today', 'is_weekday') == true }}
    card:
      type: entities
      title: >
        üìÖ Today - {{ now().strftime('%A, %B %d') }}
      entities:
        # Blue Line Today
        - type: conditional
          conditions:
            - condition: template
              value_template: >
                {{ states('sensor.schoolcafe_blue_line_today') not in ['unavailable', 'unknown', 'No items available'] }}
          row:
            entity: sensor.schoolcafe_blue_line_today
            name: "üîµ Blue Line"
            icon: mdi:food
            secondary_info: >
              {% set items = state_attr('sensor.schoolcafe_blue_line_today', 'items') %}
              {% if items and items|length > 0 %}
                {% set item = items[0] %}
                {{ item.calories }} cal ‚Ä¢ {{ item.rating }}‚≠ê ‚Ä¢ {{ item.likes_percentage }}% like it
              {% endif %}
        
        # Gold Line Today
        - type: conditional
          conditions:
            - condition: template
              value_template: >
                {{ states('sensor.schoolcafe_gold_line_today') not in ['unavailable', 'unknown', 'No items available'] }}
          row:
            entity: sensor.schoolcafe_gold_line_today
            name: "üü° Gold Line"
            icon: mdi:food
            secondary_info: >
              {% set items = state_attr('sensor.schoolcafe_gold_line_today', 'items') %}
              {% if items and items|length > 0 %}
                {% set item = items[0] %}
                {{ item.calories }} cal ‚Ä¢ {{ item.rating }}‚≠ê ‚Ä¢ {{ item.likes_percentage }}% like it
              {% endif %}

  # Upcoming School Days - Dynamic list that only shows weekdays
  - type: entities
    title: "üìã Upcoming School Days"
    entities:
      # Tomorrow
      - type: conditional
        conditions:
          - condition: template
            value_template: >
              {{ state_attr('sensor.schoolcafe_blue_line_tomorrow', 'is_weekday') == true }}
        row:
          entity: sensor.schoolcafe_blue_line_tomorrow
          name: >
            Tomorrow ({{ (now().date() + timedelta(days=1)).strftime('%a %m/%d') }})
          icon: mdi:calendar-today
          secondary_info: >
            {% if states('sensor.schoolcafe_blue_line_tomorrow') not in ['unavailable', 'unknown', 'No items available'] %}
              üîµ {{ states('sensor.schoolcafe_blue_line_tomorrow') }}
            {% elif states('sensor.schoolcafe_gold_line_tomorrow') not in ['unavailable', 'unknown', 'No items available'] %}
              üü° {{ states('sensor.schoolcafe_gold_line_tomorrow') }}
            {% else %}
              No Menu Available
            {% endif %}

      # Day +2
      - type: conditional
        conditions:
          - condition: template
            value_template: >
              {{ state_attr('sensor.schoolcafe_blue_line_today_plus2', 'is_weekday') == true }}
        row:
          entity: sensor.schoolcafe_blue_line_today_plus2
          name: >
            {{ (now().date() + timedelta(days=2)).strftime('%A %m/%d') }}
          icon: mdi:calendar-today
          secondary_info: >
            {% if states('sensor.schoolcafe_blue_line_today_plus2') not in ['unavailable', 'unknown', 'No items available'] %}
              üîµ {{ states('sensor.schoolcafe_blue_line_today_plus2') }}
            {% elif states('sensor.schoolcafe_gold_line_today_plus2') not in ['unavailable', 'unknown', 'No items available'] %}
              üü° {{ states('sensor.schoolcafe_gold_line_today_plus2') }}
            {% else %}
              No Menu Available
            {% endif %}

      # Day +3
      - type: conditional
        conditions:
          - condition: template
            value_template: >
              {{ state_attr('sensor.schoolcafe_blue_line_today_plus3', 'is_weekday') == true }}
        row:
          entity: sensor.schoolcafe_blue_line_today_plus3
          name: >
            {{ (now().date() + timedelta(days=3)).strftime('%A %m/%d') }}
          icon: mdi:calendar-today
          secondary_info: >
            {% if states('sensor.schoolcafe_blue_line_today_plus3') not in ['unavailable', 'unknown', 'No items available'] %}
              üîµ {{ states('sensor.schoolcafe_blue_line_today_plus3') }}
            {% elif states('sensor.schoolcafe_gold_line_today_plus3') not in ['unavailable', 'unknown', 'No items available'] %}
              üü° {{ states('sensor.schoolcafe_gold_line_today_plus3') }}
            {% else %}
              No Menu Available
            {% endif %}

      # Day +4
      - type: conditional
        conditions:
          - condition: template
            value_template: >
              {{ state_attr('sensor.schoolcafe_blue_line_today_plus4', 'is_weekday') == true }}
        row:
          entity: sensor.schoolcafe_blue_line_today_plus4
          name: >
            {{ (now().date() + timedelta(days=4)).strftime('%A %m/%d') }}
          icon: mdi:calendar-today
          secondary_info: >
            {% if states('sensor.schoolcafe_blue_line_today_plus4') not in ['unavailable', 'unknown', 'No items available'] %}
              üîµ {{ states('sensor.schoolcafe_blue_line_today_plus4') }}
            {% elif states('sensor.schoolcafe_gold_line_today_plus4') not in ['unavailable', 'unknown', 'No items available'] %}
              üü° {{ states('sensor.schoolcafe_gold_line_today_plus4') }}
            {% else %}
              No Menu Available
            {% endif %}

      # Day +5
      - type: conditional
        conditions:
          - condition: template
            value_template: >
              {{ state_attr('sensor.schoolcafe_blue_line_today_plus5', 'is_weekday') == true }}
        row:
          entity: sensor.schoolcafe_blue_line_today_plus5
          name: >
            {{ (now().date() + timedelta(days=5)).strftime('%A %m/%d') }}
          icon: mdi:calendar-today
          secondary_info: >
            {% if states('sensor.schoolcafe_blue_line_today_plus5') not in ['unavailable', 'unknown', 'No items available'] %}
              üîµ {{ states('sensor.schoolcafe_blue_line_today_plus5') }}
            {% elif states('sensor.schoolcafe_gold_line_today_plus5') not in ['unavailable', 'unknown', 'No items available'] %}
              üü° {{ states('sensor.schoolcafe_gold_line_today_plus5') }}
            {% else %}
              No Menu Available
            {% endif %}

      # Day +6
      - type: conditional
        conditions:
          - condition: template
            value_template: >
              {{ state_attr('sensor.schoolcafe_blue_line_today_plus6', 'is_weekday') == true }}
        row:
          entity: sensor.schoolcafe_blue_line_today_plus6
          name: >
            {{ (now().date() + timedelta(days=6)).strftime('%A %m/%d') }}
          icon: mdi:calendar-today
          secondary_info: >
            {% if states('sensor.schoolcafe_blue_line_today_plus6') not in ['unavailable', 'unknown', 'No items available'] %}
              üîµ {{ states('sensor.schoolcafe_blue_line_today_plus6') %}
            {% elif states('sensor.schoolcafe_gold_line_today_plus6') not in ['unavailable', 'unknown', 'No items available'] %}
              üü° {{ states('sensor.schoolcafe_gold_line_today_plus6') }}
            {% else %}
              No Menu Available
            {% endif %}

  # Weekend/No School Message
  - type: conditional
    conditions:
      - condition: template
        value_template: >
          {{ state_attr('sensor.schoolcafe_blue_line_today', 'is_weekday') == false }}
    card:
      type: markdown
      content: |
        ## üèñÔ∏è No School Today
        
        Today is {{ now().strftime('%A') }} - enjoy your day off!
        
        The next school day menus will be shown automatically.

  # Quick Stats Card
  - type: entities
    title: "üìä Quick Stats"
    entities:
      - type: attribute
        entity: sensor.schoolcafe_blue_line_today
        attribute: school_id
        name: "School ID"
        icon: mdi:school
      
      - type: attribute
        entity: sensor.schoolcafe_blue_line_today
        attribute: grade
        name: "Grade Level"
        icon: mdi:account-school
      
      - type: attribute
        entity: sensor.schoolcafe_blue_line_today
        attribute: meal_type
        name: "Meal Type"
        icon: mdi:silverware-fork-knife